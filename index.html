<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Engineering Faculty Portal</title>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // ‚úÖ Your EmailJS public key
      emailjs.init("d9IT7uMZf8i1YmPOGNAFU");
    });
  </script>

  <style>
    :root{
      --primary-blue:#003d82;
      --secondary-blue:#0056b3;
      --accent-yellow:#FFD700;
      --light-bg:#f8fafc;
      --white:#ffffff;
      --text-dark:#1e293b;
      --text-light:#ffffff;
      --text-muted:#64748b;
      --border-color:#e2e8f0;
      --shadow:rgba(0,61,130,0.1);
      --gradient-bg:linear-gradient(135deg,#f8fafc 0%,#ffffff 50%,#f8fafc 100%);
    }
    [data-theme="dark"]{
      --primary-blue:#0056b3;
      --secondary-blue:#003d82;
      --accent-yellow:#FFC107;
      --light-bg:#0f172a;
      --white:#1e293b;
      --text-dark:#f1f5f9;
      --text-light:#f1f5f9;
      --text-muted:#94a3b8;
      --border-color:#334155;
      --shadow:rgba(0,0,0,0.3);
      --gradient-bg:linear-gradient(135deg,#0f172a 0%,#1e293b 50%,#0f172a 100%);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Segoe UI',system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      line-height:1.6;
      color:var(--text-dark);
      background:var(--gradient-bg);
      transition:background .3s ease,color .3s ease;
    }
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes slideInRight{from{opacity:0;transform:translateX(30px)}to{opacity:1;transform:translateX(0)}}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
    @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
    @keyframes glow{0%,100%{box-shadow:0 0 20px rgba(255,215,0,.5)}50%{box-shadow:0 0 40px rgba(255,215,0,.8)}}

    .animate-fadeIn{animation:fadeIn .6s ease-out}
    .animate-slideIn{animation:slideInRight .5s ease-out}
    .animate-float{animation:float 3s ease-in-out infinite}

    header{
      background:linear-gradient(135deg,var(--primary-blue),var(--secondary-blue));
      color:var(--text-light);
      padding:1rem 2rem;
      box-shadow:0 4px 20px var(--shadow);
      position:sticky;top:0;z-index:1000;
      border-bottom:4px solid var(--accent-yellow);
    }
    .header-container{
      max-width:1400px;margin:0 auto;
      display:flex;justify-content:space-between;align-items:center;
      flex-wrap:wrap;gap:1rem;
    }
    .logo-section{display:flex;align-items:center;gap:1rem}
    .logo-img{height:50px;background:white;padding:.3rem;border-radius:8px}
    .logo-text{font-size:1.5rem;font-weight:700}
    nav{display:flex;gap:.5rem;flex-wrap:wrap;align-items:center}
    .nav-btn{
      background:rgba(255,255,255,.1);
      color:var(--text-light);
      border:2px solid rgba(255,255,255,.2);
      padding:.6rem 1.2rem;border-radius:8px;
      cursor:pointer;font-weight:600;
      transition:.3s ease;font-size:.95rem;
    }
    .nav-btn:hover{background:rgba(255,255,255,.2);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.2)}
    .nav-btn.active{background:var(--accent-yellow);color:var(--primary-blue);border-color:var(--accent-yellow)}
    .dark-mode-toggle{
      background:var(--accent-yellow);color:var(--primary-blue);
      border:none;padding:.6rem 1rem;border-radius:8px;
      cursor:pointer;font-size:1.2rem;font-weight:700;
      transition:.3s ease;
    }
    .dark-mode-toggle:hover{transform:scale(1.1) rotate(15deg);animation:glow 1s infinite}

    .hero{
      background:linear-gradient(135deg,var(--primary-blue),var(--secondary-blue),var(--primary-blue));
      color:var(--text-light);
      padding:4rem 2rem;text-align:center;
      position:relative;overflow:hidden;
    }
    .hero::before{
      content:"";position:absolute;top:-50%;left:-50%;
      width:200%;height:200%;
      background:radial-gradient(circle,rgba(255,255,255,.1) 1px,transparent 1px);
      background-size:50px 50px;animation:float 20s linear infinite;
    }
    .hero-content{position:relative;z-index:2;max-width:1000px;margin:0 auto}
    .hero h1{font-size:3rem;font-weight:900;margin-bottom:1rem;text-shadow:2px 2px 8px rgba(0,0,0,.3)}
    .hero p{font-size:1.2rem;margin-bottom:1rem;color:#e0f2ff}

    .container{max-width:1400px;margin:0 auto;padding:2.5rem 2rem}
    .section-title{text-align:center;font-size:2.2rem;font-weight:800;margin-bottom:.6rem}
    .section-subtitle{text-align:center;color:var(--text-muted);margin-bottom:2rem}

    .grid{display:grid;gap:1.5rem;grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}
    .card{
      background:var(--white);
      border-radius:16px;
      padding:1.6rem;
      box-shadow:0 4px 20px var(--shadow);
      border:2px solid transparent;
      transition:.3s ease;
    }
    .card:hover{transform:translateY(-6px);box-shadow:0 12px 40px var(--shadow);border-color:var(--secondary-blue)}
    .event-card{position:relative;overflow:hidden}
    .event-header{
      background:linear-gradient(135deg,#3b82f6,#2563eb);
      padding:1.6rem;margin:-1.6rem -1.6rem 1.2rem -1.6rem;
      text-align:center;border-radius:16px 16px 0 0;
    }
    .event-icon{font-size:3rem;margin-bottom:.4rem}
    .event-type{
      background:rgba(255,255,255,.9);
      color:var(--primary-blue);
      padding:.25rem 1rem;border-radius:20px;
      font-size:.8rem;font-weight:800;text-transform:uppercase;display:inline-block;
    }
    .event-title{font-size:1.25rem;font-weight:800;margin:.8rem 0 .5rem}
    .event-description{color:var(--text-muted);margin-bottom:1rem}
    .event-details{display:flex;flex-direction:column;gap:.6rem;margin-bottom:1rem}
    .event-detail-item{display:flex;align-items:center;gap:.6rem;font-weight:600}
    .detail-icon{
      width:30px;height:30px;background:#dbeafe;border-radius:50%;
      display:flex;align-items:center;justify-content:center;
    }
    .badge{
      position:absolute;top:1rem;right:1rem;
      background:linear-gradient(135deg,var(--accent-yellow),#FFA500);
      color:var(--primary-blue);
      padding:.3rem 1rem;border-radius:20px;
      font-size:.75rem;font-weight:900;z-index:5;
      animation:pulse 2s infinite;
    }
    .progress-bar{width:100%;height:8px;background:var(--border-color);border-radius:10px;overflow:hidden}
    .progress-fill{height:100%;background:linear-gradient(90deg,var(--secondary-blue),var(--primary-blue))}

    .btn{
      padding:.8rem 1rem;border:none;border-radius:10px;
      cursor:pointer;font-weight:800;transition:.25s ease;
    }
    .btn-full{width:100%}
    .btn-blue{background:linear-gradient(135deg,var(--primary-blue),var(--secondary-blue));color:var(--text-light)}
    .btn-blue:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,61,130,.3)}
    .btn-danger{background:#ef4444;color:white}
    .btn-danger:hover{background:#dc2626}
    .btn-primary{
      background:linear-gradient(135deg,var(--accent-yellow),#FFA500);
      color:var(--primary-blue);
      padding:1rem 1.4rem;border:none;border-radius:12px;
      font-weight:900;cursor:pointer;transition:.25s ease;
    }
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 12px 30px rgba(255,215,0,.35)}

    footer{
      background:linear-gradient(135deg,#1e293b,var(--primary-blue),#1e293b);
      color:var(--text-light);
      padding:2.5rem 2rem 1.2rem;
      border-top:4px solid var(--accent-yellow);
      margin-top:2rem;
    }
    .footer-content{
      max-width:1400px;margin:0 auto;
      display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
      gap:1.5rem;margin-bottom:1.5rem;
    }
    .footer-section h4{font-size:1.2rem;margin-bottom:.8rem;border-bottom:2px solid var(--accent-yellow);display:inline-block;padding-bottom:.3rem}
    .footer-section ul{list-style:none}
    .footer-section li{margin:.3rem 0}
    .footer-section a{color:#bfdbfe;text-decoration:none}
    .footer-section a:hover{color:var(--accent-yellow)}
    .footer-bottom{text-align:center;padding-top:1rem;border-top:1px solid rgba(255,255,255,.2);color:#bfdbfe}

    /* Modals */
    .modal{
      display:none;position:fixed;inset:0;
      background:rgba(0,0,0,.7);
      z-index:2000;justify-content:center;align-items:center;padding:1rem;
    }
    .modal.active{display:flex;animation:fadeIn .25s ease}
    .modal-content{
      background:var(--white);
      padding:2rem;border-radius:18px;
      max-width:520px;width:100%;
      max-height:90vh;overflow:auto;
      box-shadow:0 20px 60px rgba(0,0,0,.5);
      animation:slideInRight .3s ease;
    }
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}
    .modal-title{font-size:1.5rem;font-weight:900}
    .close-btn{
      background:none;border:none;font-size:2rem;cursor:pointer;
      color:var(--text-muted);width:40px;height:40px;border-radius:50%;
    }
    .close-btn:hover{background:var(--border-color);color:var(--text-dark)}
    .form-group{margin-bottom:1rem}
    .form-label{display:block;margin-bottom:.4rem;font-weight:800}
    .form-input,.form-select,.form-textarea{
      width:100%;padding:.8rem;border:2px solid var(--border-color);
      border-radius:10px;font-size:1rem;background:var(--light-bg);color:var(--text-dark);
    }
    .form-textarea{min-height:110px;resize:vertical}

    @media(max-width:768px){
      .hero h1{font-size:2.2rem}
      .logo-text{font-size:1.2rem}
      .nav-btn{padding:.5rem .8rem;font-size:.85rem}
    }
  </style>
</head>

<body>
<header>
  <div class="header-container">
    <div class="logo-section">
      <img class="logo-img" src="https://lms.iukl.edu.my/lms/version/2/images/logo/klust_color.png" alt="University Logo">
      <div class="logo-text">üéì Engineering Faculty</div>
    </div>
    <nav>
      <button class="nav-btn active" data-section="home">üè† Home</button>
      <button class="nav-btn" data-section="events">üìÖ Events</button>
      <button class="nav-btn" data-section="departments">üèõÔ∏è Departments</button>
      <button class="nav-btn" data-section="contact">‚úâÔ∏è Contact</button>
      <button class="nav-btn" data-section="manage" id="manageBtn">üîê Manage</button>
      <button class="dark-mode-toggle" id="darkModeToggle">üåô</button>
    </nav>
  </div>
</header>

<main id="mainContent"></main>

<footer>
  <div class="footer-content">
    <div class="footer-section">
      <img class="logo-img" style="margin-bottom:1rem" src="https://lms.iukl.edu.my/lms/version/2/images/logo/klust_color.png" alt="University Logo">
      <p style="color:#bfdbfe;">Engineering Faculty - Shaping the future through innovation and excellence in education</p>
    </div>
    <div class="footer-section">
      <h4>Quick Links</h4>
      <ul>
        <li><a href="#" data-section="home">üè† Home</a></li>
        <li><a href="#" data-section="events">üìÖ Events</a></li>
        <li><a href="#" data-section="departments">üèõÔ∏è Departments</a></li>
        <li><a href="#" data-section="contact">‚úâÔ∏è Contact</a></li>
      </ul>
    </div>
    <div class="footer-section">
      <h4>Contact Info</h4>
      <ul>
        <li>üìß engineering@university.edu</li>
        <li>üìû +60 3-1234 5678</li>
        <li>üìç Engineering Faculty Building</li>
      </ul>
    </div>
  </div>
  <div class="footer-bottom">
    <p>&copy; <span id="currentYear"></span> Engineering Faculty. All rights reserved.</p>
  </div>
</footer>

<!-- Login Modal -->
<div id="loginModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">üîê Staff Login</h2>
      <button class="close-btn" onclick="closeModal('loginModal')">&times;</button>
    </div>
    <form id="loginForm">
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="loginEmail" placeholder="staff@university.edu" required />
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" class="form-input" id="loginPassword" placeholder="Enter password" required />
      </div>
      <button type="submit" class="btn btn-blue btn-full">Login</button>
      <p style="margin-top:1rem;color:var(--text-muted);font-size:.9rem;">
        Demo: Use any email with password <b>staff123</b>
      </p>
    </form>
  </div>
</div>

<!-- Event Registration Modal -->
<div id="eventModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">üìù Register for Event</h2>
      <button class="close-btn" onclick="closeModal('eventModal')">&times;</button>
    </div>
    <form id="eventRegistrationForm">
      <div class="form-group">
        <label class="form-label">Full Name</label>
        <input type="text" class="form-input" id="participantName" required />
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="participantEmail" required />
      </div>
      <div class="form-group">
        <label class="form-label">Phone</label>
        <input type="tel" class="form-input" id="participantPhone" required />
      </div>
      <button type="submit" class="btn btn-blue btn-full">Register Now</button>
    </form>
  </div>
</div>

<!-- Contact Modal -->
<div id="contactModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">‚úâÔ∏è Send Message</h2>
      <button class="close-btn" onclick="closeModal('contactModal')">&times;</button>
    </div>
    <form id="contactForm">
      <div class="form-group">
        <label class="form-label">Name</label>
        <input type="text" class="form-input" id="contactName" required />
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="contactEmail" required />
      </div>
      <div class="form-group">
        <label class="form-label">Department</label>
        <select class="form-select" id="contactDepartment" required>
          <option value="">Select Department</option>
          <option value="civil">Civil Engineering</option>
          <option value="mechanical">Mechanical Engineering</option>
          <option value="electrical">Electrical Engineering</option>
          <option value="computer">Computer Engineering</option>
          <option value="chemical">Chemical Engineering</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Message</label>
        <textarea class="form-textarea" id="contactMessage" required></textarea>
      </div>
      <button type="submit" class="btn btn-blue btn-full">Send Message</button>
    </form>
  </div>
</div>

<!-- Event Manage Modal -->
<div id="eventManageModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="eventManageTitle">‚ûï Add Event</h2>
      <button class="close-btn" onclick="closeModal('eventManageModal')">&times;</button>
    </div>
    <form id="eventManageForm">
      <div class="form-group">
        <label class="form-label">Event Title</label>
        <input type="text" class="form-input" id="eventTitle" required />
      </div>
      <div class="form-group">
        <label class="form-label">Description</label>
        <textarea class="form-textarea" id="eventDescription" required></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">Date</label>
        <input type="date" class="form-input" id="eventDate" required />
      </div>
      <div class="form-group">
        <label class="form-label">Time</label>
        <input type="text" class="form-input" id="eventTime" placeholder="10:00 AM" required />
      </div>
      <div class="form-group">
        <label class="form-label">Location</label>
        <input type="text" class="form-input" id="eventLocation" required />
      </div>
      <div class="form-group">
        <label class="form-label">Department</label>
        <select class="form-select" id="eventDepartment" required>
          <option value="civil">Civil Engineering</option>
          <option value="mechanical">Mechanical Engineering</option>
          <option value="electrical">Electrical Engineering</option>
          <option value="computer">Computer Engineering</option>
          <option value="chemical">Chemical Engineering</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Event Type</label>
        <select class="form-select" id="eventType" required>
          <option value="seminar">Seminar</option>
          <option value="workshop">Workshop</option>
          <option value="conference">Conference</option>
          <option value="competition">Competition</option>
          <option value="webinar">Webinar</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Capacity</label>
        <input type="number" class="form-input" id="eventCapacity" min="1" required />
      </div>
      <input type="hidden" id="eventEditId" />
      <button type="submit" class="btn btn-blue btn-full">Save Event</button>
    </form>
  </div>
</div>

<script>
  // ===== DATA =====
  const eventSymbols = { seminar:"üìö", workshop:"üîß", conference:"üéì", competition:"üèÜ", webinar:"üíª" };
  const departmentNames = {
    civil:"Civil Engineering", mechanical:"Mechanical Engineering",
    electrical:"Electrical Engineering", computer:"Computer Engineering",
    chemical:"Chemical Engineering"
  };
  const departmentImages = {
    civil:"https://images.unsplash.com/photo-1503387762-592deb58ef4e?w=400",
    mechanical:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=400",
    electrical:"https://images.unsplash.com/photo-1473341304170-971dccb5ac1e?w=400",
    computer:"https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=400",
    chemical:"https://images.unsplash.com/photo-1532094349884-543bc11b234d?w=400"
  };

  let currentSection = "home";
  let isStaff = false;
  let selectedEventForRegistration = null;

  function initializeData(){
    if(!localStorage.getItem("departments")){
      const departments = [
        {id:"civil",name:"Civil Engineering",description:"Building the foundation of modern infrastructure with sustainable and innovative solutions.",studentCount:520,staffCount:32,contact:"civil@university.edu"},
        {id:"mechanical",name:"Mechanical Engineering",description:"Designing and developing mechanical systems that power the world.",studentCount:485,staffCount:28,contact:"mechanical@university.edu"},
        {id:"electrical",name:"Electrical Engineering",description:"Innovating electrical systems and electronics for a connected future.",studentCount:510,staffCount:30,contact:"electrical@university.edu"},
        {id:"computer",name:"Computer Engineering",description:"Advancing technology through software and hardware integration.",studentCount:625,staffCount:35,contact:"computer@university.edu"},
        {id:"chemical",name:"Chemical Engineering",description:"Transforming raw materials into valuable products through chemical processes.",studentCount:290,staffCount:15,contact:"chemical@university.edu"},
      ];
      localStorage.setItem("departments", JSON.stringify(departments));
    }

    if(!localStorage.getItem("events")){
      const events = [
        {id:"1",title:"Advanced Structural Engineering Seminar",description:"Learn about the latest developments in structural analysis and design techniques.",date:"2026-02-15",time:"10:00 AM",location:"Engineering Hall A",departmentId:"civil",type:"seminar",capacity:100,participants:[]},
        {id:"2",title:"Robotics Workshop",description:"Hands-on workshop on building and programming autonomous robots.",date:"2026-02-20",time:"2:00 PM",location:"Mechanical Lab 3",departmentId:"mechanical",type:"workshop",capacity:50,participants:[]},
        {id:"3",title:"International Power Systems Conference",description:"Global conference on renewable energy and smart grid technologies.",date:"2026-03-05",time:"9:00 AM",location:"Main Auditorium",departmentId:"electrical",type:"conference",capacity:300,participants:[]},
        {id:"4",title:"Hackathon 2026",description:"48-hour coding competition to solve real-world engineering problems.",date:"2026-03-12",time:"8:00 AM",location:"Computer Lab Building",departmentId:"computer",type:"competition",capacity:120,participants:[]},
        {id:"5",title:"Green Chemistry Webinar",description:"Online seminar on sustainable chemical processes and environmental protection.",date:"2026-02-28",time:"3:00 PM",location:"Online (Zoom)",departmentId:"chemical",type:"webinar",capacity:200,participants:[]},
      ];
      localStorage.setItem("events", JSON.stringify(events));
    }
  }

  function getDepartments(){ return JSON.parse(localStorage.getItem("departments") || "[]"); }
  function getEvents(){ return JSON.parse(localStorage.getItem("events") || "[]"); }
  function saveEvents(events){ localStorage.setItem("events", JSON.stringify(events)); }
  function getEventById(id){ return getEvents().find(e => e.id === id); }

  // ===== NAV =====
  function navigateTo(section){
    if(section === "manage" && !isStaff){
      openModal("loginModal");
      return;
    }
    currentSection = section;

    document.querySelectorAll(".nav-btn").forEach(btn => {
      btn.classList.remove("active");
      if(btn.dataset.section === section) btn.classList.add("active");
    });

    renderSection();
  }

  function renderSection(){
    switch(currentSection){
      case "home": renderHomePage(); break;
      case "events": renderEventsPage(); break;
      case "departments": renderDepartmentsPage(); break;
      case "contact": renderContactPage(); break;
      case "manage": if(isStaff) renderManagePage(); else renderHomePage(); break;
      default: renderHomePage();
    }
  }

  function renderHomePage(){
    const events = getEvents();
    const upcomingEvents = events
      .filter(e => new Date(e.date) >= new Date())
      .sort((a,b) => new Date(a.date) - new Date(b.date))
      .slice(0, 6);

    document.getElementById("mainContent").innerHTML = `
      <section class="hero">
        <div class="hero-content animate-fadeIn">
          <h1>‚ú® Engineering Faculty ‚ú®</h1>
          <p>Shaping Tomorrow's Innovators Through Excellence in Engineering Education</p>
          <div style="margin-top:1.2rem">
            <button class="btn-primary" onclick="navigateTo('events')">üìÖ Explore Events</button>
            <button class="btn-primary" style="margin-left:.6rem" onclick="navigateTo('departments')">üèõÔ∏è Departments</button>
          </div>
        </div>
      </section>

      <section class="container">
        <h2 class="section-title">‚≠ê Featured Upcoming Events ‚≠ê</h2>
        <p class="section-subtitle">Register and you will receive an email confirmation.</p>
        <div class="grid">
          ${upcomingEvents.map((event) => {
            const symbol = eventSymbols[event.type] || "üìå";
            const fillPercent = event.capacity ? (event.participants.length / event.capacity) * 100 : 0;
            const isFilling = fillPercent > 70;
            return `
              <div class="card event-card">
                ${isFilling ? `<div class="badge">üî• FILLING FAST</div>` : ""}
                <div class="event-header">
                  <div class="event-icon animate-float">${symbol}</div>
                  <div class="event-type">${event.type}</div>
                </div>
                <h3 class="event-title">${event.title}</h3>
                <p class="event-description">${event.description}</p>
                <div class="event-details">
                  <div class="event-detail-item"><div class="detail-icon">üìÖ</div><span>${new Date(event.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}</span></div>
                  <div class="event-detail-item"><div class="detail-icon">üïê</div><span>${event.time}</span></div>
                  <div class="event-detail-item"><div class="detail-icon">üìç</div><span>${event.location}</span></div>
                </div>
                <div style="font-size:.85rem;color:var(--text-muted);font-weight:700;margin:.7rem 0;">
                  ${departmentNames[event.departmentId]}
                </div>
                <button class="btn btn-blue btn-full" onclick="registerForEvent('${event.id}')">Register Now</button>
              </div>
            `;
          }).join("")}
        </div>
      </section>
    `;
  }

  function renderEventsPage(){
    const events = getEvents();
    document.getElementById("mainContent").innerHTML = `
      <section class="hero" style="padding:3rem 2rem;">
        <div class="hero-content">
          <h1 style="font-size:2.3rem;">üìÖ Faculty Events</h1>
          <p>Choose an event and register.</p>
        </div>
      </section>
      <section class="container">
        <div class="grid">
          ${events.map((event) => {
            const symbol = eventSymbols[event.type] || "üìå";
            const isPast = new Date(event.date) < new Date();
            return `
              <div class="card event-card">
                ${isPast ? `<div class="badge" style="background:#94a3b8;">‚úì Completed</div>` : ""}
                <div class="event-header">
                  <div class="event-icon">${symbol}</div>
                  <div class="event-type">${event.type}</div>
                </div>
                <h3 class="event-title">${event.title}</h3>
                <p class="event-description">${event.description}</p>
                <div class="event-details">
                  <div class="event-detail-item"><div class="detail-icon">üìÖ</div><span>${new Date(event.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}</span></div>
                  <div class="event-detail-item"><div class="detail-icon">üïê</div><span>${event.time}</span></div>
                  <div class="event-detail-item"><div class="detail-icon">üìç</div><span>${event.location}</span></div>
                </div>
                <div style="font-size:.85rem;color:var(--text-muted);font-weight:700;margin:.7rem 0;">
                  ${departmentNames[event.departmentId]}
                </div>
                ${!isPast ? `<button class="btn btn-blue btn-full" onclick="registerForEvent('${event.id}')">Register Now</button>`
                          : `<button class="btn btn-blue btn-full" disabled style="opacity:.6">Event Completed</button>`}
              </div>
            `;
          }).join("")}
        </div>
      </section>
    `;
  }

  function renderDepartmentsPage(){
    const departments = getDepartments();
    document.getElementById("mainContent").innerHTML = `
      <section class="hero" style="padding:3rem 2rem;">
        <div class="hero-content">
          <h1 style="font-size:2.3rem;">üèõÔ∏è Our Departments</h1>
          <p>Explore our engineering departments.</p>
        </div>
      </section>
      <section class="container">
        <div class="grid">
          ${departments.map((dept) => `
            <div class="card">
              <img src="${departmentImages[dept.id]}" alt="${dept.name}" style="width:100%;height:180px;object-fit:cover;border-radius:14px;">
              <h3 style="margin-top:1rem;font-size:1.3rem;font-weight:900">${dept.name}</h3>
              <p style="color:var(--text-muted);margin:.5rem 0 1rem">${dept.description}</p>
              <p style="font-weight:800">üìß ${dept.contact}</p>
            </div>
          `).join("")}
        </div>
      </section>
    `;
  }

  function renderContactPage(){
    document.getElementById("mainContent").innerHTML = `
      <section class="hero" style="padding:3rem 2rem;">
        <div class="hero-content">
          <h1 style="font-size:2.3rem;">‚úâÔ∏è Contact Us</h1>
          <p>Send us a message using the form.</p>
        </div>
      </section>
      <section class="container">
        <div class="card" style="max-width:600px;margin:0 auto;">
          <h2 style="font-size:1.4rem;font-weight:900;margin-bottom:1rem;">üìù Send a Message</h2>
          <button class="btn btn-blue btn-full" onclick="openModal('contactModal')">Open Contact Form</button>
        </div>
      </section>
    `;
  }

  function renderManagePage(){
    const events = getEvents();
    document.getElementById("mainContent").innerHTML = `
      <section class="hero" style="padding:3rem 2rem;">
        <div class="hero-content">
          <h1 style="font-size:2.3rem;">üîê Event Management</h1>
          <p>Add, edit, or delete events.</p>
        </div>
      </section>
      <section class="container">
        <button class="btn-primary" onclick="openAddEventModal()">‚ûï Add New Event</button>
        <div class="grid" style="margin-top:1.2rem;">
          ${events.map((event) => `
            <div class="card">
              <div style="display:flex;justify-content:space-between;align-items:start;gap:1rem;">
                <h3 style="font-size:1.2rem;font-weight:900">${event.title}</h3>
                <div style="font-size:2rem">${eventSymbols[event.type] || "üìå"}</div>
              </div>
              <p style="color:var(--text-muted);margin:.6rem 0 1rem">${event.description}</p>
              <div style="font-weight:800;margin-bottom:1rem;">${event.participants.length} / ${event.capacity || "‚àû"} registrations</div>
              <div style="display:flex;gap:.6rem;">
                <button class="btn btn-blue" style="flex:1" onclick="editEvent('${event.id}')">‚úèÔ∏è Edit</button>
                <button class="btn btn-danger" style="flex:1" onclick="deleteEvent('${event.id}')">üóëÔ∏è Delete</button>
              </div>
            </div>
          `).join("")}
        </div>
      </section>
    `;
  }

  // ===== MODALS =====
  function openModal(id){ document.getElementById(id).classList.add("active"); }
  function closeModal(id){
    document.getElementById(id).classList.remove("active");
    if(id === "eventManageModal"){
      document.getElementById("eventManageForm").reset();
      document.getElementById("eventEditId").value = "";
      document.getElementById("eventManageTitle").textContent = "‚ûï Add Event";
    }
  }

  function registerForEvent(eventId){
    selectedEventForRegistration = eventId;
    openModal("eventModal");
  }

  function openAddEventModal(){
    document.getElementById("eventManageTitle").textContent = "‚ûï Add New Event";
    document.getElementById("eventEditId").value = "";
    document.getElementById("eventManageForm").reset();
    openModal("eventManageModal");
  }

  function editEvent(eventId){
    const event = getEventById(eventId);
    if(!event) return;

    document.getElementById("eventManageTitle").textContent = "‚úèÔ∏è Edit Event";
    document.getElementById("eventEditId").value = eventId;
    document.getElementById("eventTitle").value = event.title;
    document.getElementById("eventDescription").value = event.description;
    document.getElementById("eventDate").value = event.date;
    document.getElementById("eventTime").value = event.time;
    document.getElementById("eventLocation").value = event.location;
    document.getElementById("eventDepartment").value = event.departmentId;
    document.getElementById("eventType").value = event.type;
    document.getElementById("eventCapacity").value = event.capacity || 1;

    openModal("eventManageModal");
  }

  function deleteEvent(eventId){
    if(!confirm("Are you sure you want to delete this event?")) return;
    let events = getEvents().filter(e => e.id !== eventId);
    saveEvents(events);
    renderManagePage();
    alert("‚úÖ Event deleted successfully!");
  }

  function toggleDarkMode(){
    const html = document.documentElement;
    const currentTheme = html.getAttribute("data-theme");
    const btn = document.getElementById("darkModeToggle");
    if(currentTheme === "dark"){
      html.removeAttribute("data-theme");
      btn.textContent = "üåô";
      localStorage.setItem("darkMode","false");
    }else{
      html.setAttribute("data-theme","dark");
      btn.textContent = "‚òÄÔ∏è";
      localStorage.setItem("darkMode","true");
    }
  }

  function updateManageButton(){
    const manageBtn = document.getElementById("manageBtn");
    manageBtn.textContent = isStaff ? "üîì Manage" : "üîê Staff Login";
  }

  function logout(){
    isStaff = false;
    localStorage.removeItem("isStaff");
    updateManageButton();
    navigateTo("home");
    alert("‚úÖ Logged out successfully!");
  }

  // ===== STARTUP =====
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("currentYear").textContent = new Date().getFullYear();

    initializeData();

    isStaff = localStorage.getItem("isStaff") === "true";
    updateManageButton();

    renderSection();

    document.querySelectorAll(".nav-btn").forEach(btn => {
      btn.addEventListener("click", () => navigateTo(btn.dataset.section));
    });

    document.querySelectorAll("footer a[data-section]").forEach(link => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        navigateTo(link.dataset.section);
      });
    });

    document.getElementById("darkModeToggle").addEventListener("click", toggleDarkMode);
    if(localStorage.getItem("darkMode") === "true"){
      document.documentElement.setAttribute("data-theme","dark");
      document.getElementById("darkModeToggle").textContent = "‚òÄÔ∏è";
    }

    // Login
    document.getElementById("loginForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const password = document.getElementById("loginPassword").value;
      if(password === "staff123"){
        isStaff = true;
        localStorage.setItem("isStaff","true");
        closeModal("loginModal");
        updateManageButton();
        navigateTo("manage");
        alert("‚úÖ Login successful!");
      }else{
        alert("‚ùå Invalid credentials. Use password: staff123");
      }
    });

    // Registration + EmailJS
    document.getElementById("eventRegistrationForm").addEventListener("submit", (e) => {
      e.preventDefault();

      const name = document.getElementById("participantName").value;
      const email = document.getElementById("participantEmail").value;
      const phone = document.getElementById("participantPhone").value;

      let events = getEvents();
      const eventIndex = events.findIndex(ev => ev.id === selectedEventForRegistration);

      if(eventIndex === -1){
        alert("‚ùå Event not found. Refresh the page and try again.");
        return;
      }

      if(!events[eventIndex].participants) events[eventIndex].participants = [];

      if(events[eventIndex].capacity && events[eventIndex].participants.length >= events[eventIndex].capacity){
        alert("‚ùå Sorry, this event is at full capacity!");
        return;
      }

      events[eventIndex].participants.push({ name, email, phone, registeredAt: new Date().toISOString() });
      saveEvents(events);

      // ‚úÖ Must match your template params exactly:
      // to_name, event_title, event_date, to_email
      emailjs.send("service_9im0w68", "template_tkqq1vv", {
        to_name: name,
        to_email: email,
        event_title: events[eventIndex].title,
        event_date: new Date(events[eventIndex].date).toLocaleDateString("en-US", {
          month: "short", day: "numeric", year: "numeric"
        })
      })
      .then(() => {
        alert("‚úÖ Registration successful! Confirmation email sent.");
      })
      .catch((err) => {
        console.log("EmailJS error:", err);
        alert("‚úÖ Registration saved, but email failed. Check console.");
      });

      closeModal("eventModal");
      e.target.reset();
      renderSection();
    });

    // Contact
    document.getElementById("contactForm").addEventListener("submit", (e) => {
      e.preventDefault();
      closeModal("contactModal");
      e.target.reset();
      alert("‚úÖ Message sent successfully! We will get back to you soon.");
    });

    // Manage save
    document.getElementById("eventManageForm").addEventListener("submit", (e) => {
      e.preventDefault();

      const eventId = document.getElementById("eventEditId").value;
      const eventData = {
        title: document.getElementById("eventTitle").value,
        description: document.getElementById("eventDescription").value,
        date: document.getElementById("eventDate").value,
        time: document.getElementById("eventTime").value,
        location: document.getElementById("eventLocation").value,
        departmentId: document.getElementById("eventDepartment").value,
        type: document.getElementById("eventType").value,
        capacity: parseInt(document.getElementById("eventCapacity").value, 10) || 0
      };

      let events = getEvents();

      if(eventId){
        const idx = events.findIndex(ev => ev.id === eventId);
        if(idx !== -1) events[idx] = { ...events[idx], ...eventData };
      }else{
        eventData.id = Date.now().toString();
        eventData.participants = [];
        events.push(eventData);
      }

      saveEvents(events);
      closeModal("eventManageModal");
      e.target.reset();
      renderManagePage();
      alert("‚úÖ Event saved successfully!");
    });

    // Close modal background
    document.querySelectorAll(".modal").forEach(modal => {
      modal.addEventListener("click", (e) => {
        if(e.target === modal) closeModal(modal.id);
      });
    });
  });
</script>
</body>
</html>